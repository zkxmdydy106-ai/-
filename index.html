<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì´ì‚°í™•ë¥ ë³€ìˆ˜ì˜ ê¸°ëŒ“ê°’ê³¼ í‘œì¤€í¸ì°¨ (50ë¶„ ìˆ˜ì—…ìš©)</title>
    <style>
        /* 1. Global & Variables */
        :root {
            --primary-color: #007bff; /* Blue */
            --primary-light: #6aa8ff;
            --accent-color: #ff9800; /* Orange for interaction */
            --background-color: #f0f4f7; 
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #ced4da;
            --shadow-light: 0 4px 8px rgba(0, 0, 0, 0.05);
            --shadow-strong: 0 8px 16px rgba(0, 0, 0, 0.1);
            --ai-bg: #e6f3ff; /* Light blue for AI messages */
            --user-bg: #f1f1f1; /* Light gray for user messages */
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', Roboto, 'Noto Sans KR', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px 10px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding-bottom: 20px; 
        }

        .container {
            width: 100%;
            max-width: 900px;
        }

        /* 2. Typography & Header */
        h1 {
            font-size: 2.2rem;
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
            font-weight: 800;
        }

        h2 {
            font-size: 1.6rem;
            color: var(--text-color);
            border-bottom: 4px solid var(--primary-light);
            padding-bottom: 5px;
            margin-top: 35px;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        h3 {
             font-size: 1.3rem;
             color: var(--accent-color);
             margin-top: 20px;
             margin-bottom: 10px;
        }

        /* 3. Card/Module Styling */
        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow-strong);
            padding: 25px;
            margin-bottom: 30px;
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.4, 1), box-shadow 0.4s ease;
            border: 1px solid var(--border-color);
        }

        /* 4. Canvas Styling & Dice Overlay */
        canvas {
            width: 100%;
            border: 2px solid var(--primary-light);
            border-radius: 10px;
            background-color: #ffffff;
            margin-top: 15px;
        }
        
        #diceSimulationContainer {
            position: relative;
        }

        #diceOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary-color);
            z-index: 10;
        }

        /* 5. Button & Form Elements (Enhanced Touch Targets) */
        .btn {
            display: block;
            width: 100%;
            padding: 16px; /* Great for touch */
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--card-bg);
            background-color: var(--primary-color);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.15s ease, box-shadow 0.3s ease;
            box-shadow: var(--shadow-light);
            margin-top: 15px;
        }

        .btn:hover {
            background-color: var(--primary-light);
            box-shadow: var(--shadow-strong);
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }
        
        .quiz-btn {
            background-color: #28a745;
        }
        .quiz-btn:hover {
            background-color: #218838;
        }

        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 14px; /* Great for touch */
            margin-bottom: 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 1.1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input[type="number"]:focus, input[type="text"]:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.2);
            outline: none;
        }
        
        /* ìˆ˜ì‹ ì˜ì—­ ìŠ¤íƒ€ì¼ (êµê³¼ì„œì²˜ëŸ¼ ë³´ì´ë„ë¡ ë‹¨ìˆœí™”) */
        .math-expr {
            font-family: 'Malgun Gothic', 'Noto Sans KR', sans-serif; 
            font-size: 1.15rem;
            background-color: #e9ecef;
            padding: 3px 6px;
            border-radius: 4px;
            display: inline-block;
            margin: 0 2px;
            color: #495057;
            white-space: nowrap;
        }
        
        .formula-display {
            background-color: #e3f2fd; /* Light blue for formula box */
            border-left: 5px solid var(--primary-color);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 1.05rem;
            font-weight: 600;
            overflow-x: auto; 
        }
        .formula-display strong {
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .quiz-feedback {
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: 600;
            min-height: 50px;
            font-size: 1.05rem;
            transition: all 0.3s ease;
        }

        .correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .incorrect {
            background-color: #f8d7da; 
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ë§ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 1rem;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        .data-table th {
            background-color: var(--primary-light);
            color: white;
        }
        .data-table tr:nth-child(even) {
            background-color: #f8f8ff;
        }
        
        /* ê¸°íƒ€ ìŠ¤íƒ€ì¼ */
        .stat-label { color: #6c757d; }
        .stat-value { color: var(--accent-color); font-size: 1.8rem; font-weight: 800; }
        .practice-input-group label { text-align: right; font-weight: bold; flex-basis: 120px; }

        /* 7. Chat Styles */
        .message {
            display: flex;
            margin-bottom: 10px;
            max-width: 100%;
        }

        .user-message {
            margin-left: auto;
            justify-content: flex-end;
        }

        .ai-message {
            margin-right: auto;
            justify-content: flex-start;
        }

        .message-content {
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 1rem;
            line-height: 1.4;
            word-break: break-word;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .user-message .message-content {
            background-color: var(--user-bg);
            color: var(--text-color);
            border-bottom-right-radius: 4px;
        }

        .ai-message .message-content {
            background-color: var(--ai-bg);
            color: var(--primary-color);
            border-bottom-left-radius: 4px;
            border: 1px solid #cce5ff;
        }

        .loading-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            margin: 0 1px;
            border-radius: 50%;
            background-color: var(--primary-color);
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        .loading-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes bounce {
          0%, 80%, 100% { transform: scale(0); }
          40% { transform: scale(1.0); }
        }
        
        /* 8. Floating Chat Widget (New Fixed Interface) */
        #chat-toggle-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            font-size: 1.5rem;
            border: none;
            box-shadow: var(--shadow-strong);
            cursor: pointer;
            z-index: 2000;
            transition: background-color 0.3s;
        }
        #chat-toggle-button:hover { background-color: var(--primary-light); }

        #floating-chat-widget {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 90vw; /* Mobile width */
            max-width: 400px; /* Desktop max width */
            height: 70vh;
            max-height: 500px;
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            z-index: 1999;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            opacity: 1;
            pointer-events: auto;
        }

        #floating-chat-widget.closed {
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px) scale(0.95);
        }

        #chat-header {
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #close-chat-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0;
            margin: 0;
            width: 20px;
            height: 20px;
            line-height: 1;
        }
        
        #chatbox {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: #fdfdff;
            scroll-behavior: smooth;
        }

        #chat-input-container {
            padding: 10px 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
        }

        #chatInput {
            flex-grow: 1;
            margin-bottom: 0;
        }

        #sendButton {
            width: 100px;
            padding: 10px;
            margin-top: 0;
            font-size: 1rem;
            white-space: nowrap;
        }

        /* Mobile specific styling for full-screen chat */
        @media (max-width: 600px) {
            #floating-chat-widget {
                bottom: 0;
                right: 0;
                width: 100vw;
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
            }
            #chat-header {
                border-radius: 0;
            }
            #chat-toggle-button {
                bottom: 10px;
                right: 10px;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>ì´ì‚°í™•ë¥ ë³€ìˆ˜ì˜ ê¸°ëŒ“ê°’ê³¼ í‘œì¤€í¸ì°¨</h1>

        <!-- Section 1: ê°œë… ë„ì…: í‰ê·  ê³„ì‚°ì˜ í™•ë¥ ì  ë³€í™˜ (ì ìˆ˜ ì‚¬ë¡€) -->
        <div class="card">
            <h2>1. ğŸ’¡ ê°œë… ë„ì…: í‰ê·  ê³„ì‚°ì˜ ìƒˆë¡œìš´ ì‹œê°</h2>
            <p>
                10ëª… í•™ê¸‰ì˜ ìˆ˜í•™ ì ìˆ˜ ë¶„í¬ë¥¼ ê°€ì •í•©ë‹ˆë‹¤: 40ì (3ëª…), 50ì (5ëª…), 60ì (2ëª…)
            </p>
            
            <h3>(1) ì „í†µì ì¸ í‰ê·  ê³„ì‚° (ì´í•©/ì´ì¸ì›)</h3>
            <p>
                ì´ ë°˜ í•™ìƒë“¤ì˜ í‰ê· ì„ êµ¬í•˜ëŠ” ë°©ë²•ì€ ì ìˆ˜ì˜ ì´í•©ì„ í•™ìƒ ìˆ˜(10ëª…)ë¡œ ë‚˜ëˆ„ëŠ” ê²ƒì…ë‹ˆë‹¤. 
                <br>
                ì ìˆ˜ì˜ ì´í•© ê³„ì‚°: <span class="math-expr">(40 x 3) + (50 x 5) + (60 x 2) = 120 + 250 + 120 = 490</span>ì 
                <br>
                í•™ìƒ ìˆ˜ì˜ ì´í•©ì€ <span class="math-expr">3 + 5 + 2 = 10</span>ëª…ì…ë‹ˆë‹¤.
                <br>
                í‰ê·  ì ìˆ˜ëŠ” <span class="math-expr">490 / 10 = 49</span>ì  ì…ë‹ˆë‹¤.
            </p>

            <h3>(2) í‰ê·  ê³„ì‚° ë°©ì‹ì„ í™•ë¥ ì  ê´€ì ìœ¼ë¡œ ë³€í™˜</h3>
            <p>
                ê¸°ì¡´ ê³„ì‚°ì‹ì„ ë‹¤ìŒê³¼ ê°™ì´ ì¬ë°°ì—´í•©ë‹ˆë‹¤:
            </p>
            <div class="formula-display">
                <span class="math-expr">40 x (3/10) + 50 x (5/10) + 60 x (2/10)</span>
            </div>
            
            <p>
                ì´ ë‘ ì‹ì€ ë³¸ì§ˆì ìœ¼ë¡œ ë™ì¼í•˜ë©°, ë‹¨ì§€ ì“°ëŠ” ë°©ë²•ë§Œ ë°”ê¾¼ ê²ƒì…ë‹ˆë‹¤. 
            </p>

            <h3>í™•ë¥ ì  í•´ì„ ë„ì…</h3>
            <p>
                ì£¼ëª©í•´ì•¼ í•  ë¶€ë¶„ì€ <span class="math-expr">3/10, 5/10, 2/10</span> ê°’ë“¤ì…ë‹ˆë‹¤.
                <br>
                <span class="math-expr">3/10</span>ì€ 10ëª… ì¤‘ ì„ì˜ë¡œ 1ëª…ì„ ë½‘ì•˜ì„ ë•Œ ê·¸ í•™ìƒì´ 40ì ì„ ë§ì•˜ì„ **í™•ë¥ **ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
                <br>
                ë”°ë¼ì„œ í‰ê· ì€ **(ì ìˆ˜) x (í•´ë‹¹ ì ìˆ˜ë¥¼ ë°›ì„ í™•ë¥ )**ì„ ëª¨ë‘ ë”í•˜ì—¬ ê³„ì‚°ë©ë‹ˆë‹¤.
            </p>
        </div>

        <!-- Section 2: ê¸°ëŒ“ê°’ E(X)ì˜ ì •ì˜ì™€ ê³µì‹í™” -->
        <div class="card">
            <h2>2. ğŸ¯ ê¸°ëŒ“ê°’ E(X)ì˜ ì •ì˜ì™€ ê³µì‹í™”</h2>
            
            <h3>(1) ê¸°ëŒ“ê°’ê³¼ í‰ê· ì˜ ì°¨ì´ì </h3>
            <p>
                <strong>ê¸°ëŒ“ê°’ E(X)</strong>ì€ ë§ ê·¸ëŒ€ë¡œ ê¸°ëŒ€í•  ìˆ˜ ìˆëŠ” ê°’ì„ ì˜ë¯¸í•˜ë©°, í™•ë¥ ì  ê´€ì ì—ì„œ ê³„ì‚°ëœ **í‰ê· **ì…ë‹ˆë‹¤. 
            </p>
            
            <h3>(2) ê¸°ëŒ“ê°’ ê°œë…ì´ í•„ìš”í•œ ìƒí™© (í†µê³„ì  ì¶”ì •)</h3>
            <p>
                ë§Œì•½ ìˆ˜ë§ì€ í•™ìƒ(ì˜ˆ: 5ë§Œ ëª…)ì´ ì‹œí—˜ì„ ë´¤ì„ ë•Œ, ëª¨ë“  ë°ì´í„°ë¥¼ ì§‘ê³„í•˜ëŠ” ëŒ€ì‹  í‘œë³¸(Sample)ì„ ì¶”ì¶œí•˜ì—¬ ì „ì²´ í‰ê· ì„ ì¶”ì •í•´ì•¼ í•  ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.
                <br>
                ì˜ˆë¥¼ ë“¤ì–´ 100ëª… ì¤‘ 10ëª…ì„ ì„ì˜ë¡œ ì¶”ì¶œí•˜ì—¬ ì ìˆ˜ë¥¼ ë´¤ë”ë‹ˆ 40ì (3ëª…), 50ì (5ëª…), 60ì (2ëª…)ì´ ë‚˜ì™”ë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤. ì´ë•Œ <span class="math-expr">3/10, 5/10, 2/10</span>ëŠ” 100ëª… ì „ì²´ì—ì„œ í•´ë‹¹ ì ìˆ˜ë¥¼ ë§ì„ í•™ìƒì˜ ê°€ëŠ¥ì„±(**í™•ë¥ **)ì„ ë‚˜íƒ€ë‚´ëŠ” ê°’ìœ¼ë¡œ í•´ì„ë©ë‹ˆë‹¤.
                <br>
                ì¦‰, 100ëª… ì¤‘ ì•½ 30%ê°€ 40ì ì„ ë§ì„ ê²ƒìœ¼ë¡œ **ê¸°ëŒ€**í•  ìˆ˜ ìˆë‹¤ëŠ” ì˜ë¯¸ì´ë©°, ì´ë ‡ê²Œ í™•ë¥  ê°œë…ì„ ë™ë°˜í•˜ì—¬ êµ¬í•œ í‰ê· ì´ ë°”ë¡œ **ê¸°ëŒ“ê°’**ì…ë‹ˆë‹¤.
            </p>
            
            <p>
                **ê¸°ëŒ“ê°’ì˜ í‘œê¸°ë²•:** <span class="math-expr">E(X)</span>ë¡œ í‘œê¸°í•˜ë©°, í‰ê· (Mean)ì„ ì˜ë¯¸í•˜ëŠ” <span class="math-expr">m</span>ì„ ì‚¬ìš©í•˜ì—¬ <span class="math-expr">E(X) = m</span>ë¡œ ë‚˜íƒ€ë‚´ê¸°ë„ í•©ë‹ˆë‹¤.
            </p>
            
            <h3>(3) ì´ì‚°í™•ë¥ ë³€ìˆ˜ì˜ ê¸°ëŒ“ê°’ ê³µì‹í™”</h3>
            <p>
                í™•ë¥  ë³€ìˆ˜ê°€ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ê°’ì´ x1ë¶€í„° xnì´ê³ , ê·¸ì— í•´ë‹¹í•˜ëŠ” í™•ë¥  ê°’ì´ p1ë¶€í„° pnì¼ ë•Œ, ê¸°ëŒ“ê°’ E(X)ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê³„ì‚°ë©ë‹ˆë‹¤. 
                <br>
                ê¸°ëŒ“ê°’ì„ êµ¬í•  ë•ŒëŠ” í™•ë¥  ë³€ìˆ˜ (ì ìˆ˜)ì— ê·¸ ê°’ì´ ë‚˜ì˜¬ í™•ë¥  ê°’ì„ ê³±í•œ í›„, ì´ ê°’ë“¤ì„ ëª¨ë‘ ë”í•´ì£¼ë©´ ë©ë‹ˆë‹¤.
            </p>
            <div class="formula-display">
                <strong>E(X) = m</strong> <span class="math-expr">= x1 p1 + x2 p2 + ... + xn pn</span>
                <br>
                ê¸°í˜¸ë¡œëŠ” <span class="math-expr">&Sigma;(i=1~n) xi pi</span> ë¡œ í‘œí˜„ë©ë‹ˆë‹¤. (ì—¬ê¸°ì„œ <span class="math-expr">&Sigma;</span>ëŠ” **ì‹œê·¸ë§ˆ ëŒ€ë¬¸ì** ê¸°í˜¸ì…ë‹ˆë‹¤.)
            </div>

            <h3>(4) ë¶„ì‚° V(X)ì™€ í‘œì¤€í¸ì°¨ Ïƒ(X)</h3>
            <p>
                **ë¶„ì‚° V(X)**: í‰ê· (<span class="math-expr">m</span>)ìœ¼ë¡œë¶€í„° í™•ë¥ ë³€ìˆ˜ê°€ ì–¼ë§ˆë‚˜ í¼ì ¸ìˆëŠ”ì§€ ì¸¡ì •í•˜ëŠ” ê°’ì…ë‹ˆë‹¤. <span class="math-expr">V(X) = E((X - m)&sup2;)</span>
            </p>
            <p>
                **í‘œì¤€í¸ì°¨ Ïƒ(X)**: ë¶„ì‚°ì˜ ì–‘ì˜ ì œê³±ê·¼ì…ë‹ˆë‹¤. <span class="math-expr">&sigma;(X) = &radic;V(X)</span>.
            </p>

            <canvas id="conceptCanvas" width="900" height="300"></canvas>
            <div style="text-align: center; margin-top: 10px; font-size: 0.9rem; color: #555;">
                <span style="color: green; font-weight: bold;">[ì´ˆë¡ìƒ‰]</span> í‘œì¤€í¸ì°¨ <span class="math-expr">&sigma;</span>(X)ê°€ **ì‘ìŒ** (ë°€ì§‘) vs. 
                <span style="color: red; font-weight: bold;">[ë¹¨ê°„ìƒ‰]</span> í‘œì¤€í¸ì°¨ <span class="math-expr">&sigma;</span>(X)ê°€ **í¼** (ë¶„ì‚°)
            </div>
        </div>

        <!-- Section 3: ê¸°ëŒ“ê°’ ê³„ì‚° ì—°ìŠµ 2: ì œë¹„ë½‘ê¸°ì™€ ì˜ì‚¬ê²°ì • -->
        <div class="card">
            <h2>3. ğŸ° ê¸°ëŒ“ê°’ ê³„ì‚° ì—°ìŠµ: ì œë¹„ë½‘ê¸°ì™€ ì˜ì‚¬ê²°ì •</h2>
            <p>
                ì´ 10ê°œì˜ ì œë¹„ê°€ ìˆìœ¼ë©°, 1ë“±(1ê°œ), 2ë“±(2ê°œ), 3ë“±(3ê°œ), ê½(4ê°œ)ì´ ë“¤ì–´ ìˆìŠµë‹ˆë‹¤.
                ìƒê¸ˆì„ í™•ë¥  ë³€ìˆ˜ Xë¼ê³  í•  ë•Œ, ê° ë“±ìˆ˜ë³„ í™•ë¥ ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
            </p>
            
            <table class="data-table">
                <thead>
                    <tr><th>í™•ë¥ ë³€ìˆ˜ X (ìƒê¸ˆ, ë§Œì›)</th><th>1,000</th><th>200</th><th>50</th><th>0</th></tr>
                </thead>
                <tbody>
                    <tr><th>í™•ë¥  P(X=x)</th><th>1/10</th><th>2/10</th><th>3/10</th><th>4/10</th></tr>
                </tbody>
            </table>

            <h3>ê¸°ëŒ“ê°’ ê³„ì‚°</h3>
            <p>
                E(X) <span class="math-expr">= (1000 x 1/10) + (200 x 2/10) + (50 x 3/10) + (0 x 4/10)</span>
                <br>
                E(X) <span class="math-expr">= 100 + 40 + 15 + 0 = 155</span>ë§Œ ì›
            </p>
            
            <div class="formula-display" style="background-color: #f7e6e6; border-left-color: red;">
                <strong>ê¸°ëŒ“ê°’ì„ ì´ìš©í•œ ì˜ì‚¬ê²°ì •:</strong>
                <br>
                ì°¸ê°€ë¹„ê°€ <span class="math-expr">155</span>ë§Œ ì›ë³´ë‹¤ ë§ë‹¤ë©´ (ì˜ˆ: <span class="math-expr">200</span>ë§Œ ì›): ì´ ë„ë°•ì— ì°¸ê°€í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤. ê¸°ëŒ€ë˜ëŠ” ê°’ë³´ë‹¤ ë” ë§ì€ ë¹„ìš©ì„ ì§€ë¶ˆí•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 
                <br>
                ì°¸ê°€ë¹„ê°€ <span class="math-expr">155</span>ë§Œ ì›ë³´ë‹¤ ì ë‹¤ë©´ (ì˜ˆ: <span class="math-expr">100</span>ë§Œ ì›): í•´ë³¼ ë§Œí•©ë‹ˆë‹¤. ê¸°ëŒ€ê°’ë³´ë‹¤ ì ì€ ë¹„ìš©ìœ¼ë¡œ ì°¸ì—¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
            </div>
        </div>
        
        <!-- Section 4: ê°„ë‹¨í•œ ì ìš© ë¬¸ì œ ì¶”ê°€ (ì¸í„°ë™í‹°ë¸Œ) -->
        <div class="card">
            <h2>4. ğŸ§© ê°„ë‹¨í•œ í™•ë¥ ë³€ìˆ˜ ì ìš© ë¬¸ì œ</h2>
            
            <h3>(1) ì£¼ì‚¬ìœ„ 2ê°œ í•©ì˜ ê¸°ëŒ“ê°’ E(X)</h3>
            <p>
                ì„œë¡œ ë‹¤ë¥¸ ë‘ ê°œì˜ ì£¼ì‚¬ìœ„ë¥¼ ë˜ì ¸ ë‚˜ì˜¤ëŠ” ëˆˆì˜ í•©ì„ í™•ë¥ ë³€ìˆ˜ Xë¼ê³  í•  ë•Œ, ê¸°ëŒ“ê°’ E(X)ë¥¼ ê³„ì‚°í•´ ë´…ì‹œë‹¤.
            </p>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>X (í•©)</th>
                        <th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th>
                        <th>8</th><th>9</th><th>10</th><th>11</th><th>12</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>P(X=x)</th>
                        <th>1/36</th><th>2/36</th><th>3/36</th><th>4/36</th><th>5/36</th><th>6/36</th>
                        <th>5/36</th><th>4/36</th><th>3/36</th><th>2/36</th><th>1/36</th>
                    </tr>
                </tbody>
            </table>
            <label for="diceSumAnswer" class="stat-label" style="display: block; margin-top: 15px; margin-bottom: 5px;">ê¸°ëŒ“ê°’ E(X)ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</label>
            <input type="number" id="diceSumAnswer" placeholder="ì •ë‹µì„ ì…ë ¥" step="1">
            <button class="btn quiz-btn" id="checkDiceSumBtn">ì •ë‹µ í™•ì¸</button>
            <div class="quiz-feedback" id="diceSumFeedback"></div>
            
            <h3 style="margin-top: 30px;">(2) ë™ì „ 3íšŒ ë˜ì§€ê¸° ìƒê¸ˆì˜ ê¸°ëŒ“ê°’ E(ìƒê¸ˆ)</h3>
            <p>
                ë™ì „ì„ 3íšŒ ë˜ì ¸ ì•ë©´(H)ì´ ë‚˜ì˜¤ëŠ” íšŸìˆ˜ë¥¼ í™•ë¥ ë³€ìˆ˜ Xë¼ê³  í•©ë‹ˆë‹¤. ìƒê¸ˆì€ (Xì˜ ì œê³±) x 100ì›ì¼ ë•Œ, ê¸°ëŒ€ë˜ëŠ” ìƒê¸ˆì˜ ê¸°ëŒ“ê°’ E(ìƒê¸ˆ)ì„ êµ¬í•©ë‹ˆë‹¤. (ìƒê¸ˆ = <span class="math-expr">Y = 100X&sup2;</span>)
            </p>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ì•ë©´ íšŸìˆ˜ X</th><th>0</th><th>1</th><th>2</th><th>3</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>ìƒê¸ˆ Y (<span class="math-expr">100X&sup2;</span>, ì›)</th>
                        <th>0</th><th>100</th><th>400</th><th>900</th>
                    </tr>
                    <tr>
                        <th>í™•ë¥  P(X=x)</th>
                        <th>1/8</th><th>3/8</th><th>3/8</th><th>1/8</th>
                    </tr>
                </tbody>
            </table>
            <label for="coinPrizeAnswer" class="stat-label" style="display: block; margin-top: 15px; margin-bottom: 5px;">ê¸°ëŒ€ë˜ëŠ” ìƒê¸ˆ(ì›)ì„ ì…ë ¥í•˜ì„¸ìš”:</label>
            <input type="number" id="coinPrizeAnswer" placeholder="ì •ë‹µì„ ì…ë ¥" step="1">
            <button class="btn quiz-btn" id="checkCoinPrizeBtn">ì •ë‹µ í™•ì¸</button>
            <div class="quiz-feedback" id="coinPrizeFeedback"></div>
        </div>


        <!-- Section 5: ì¸í„°ë™í‹°ë¸Œ ì‹¤ìŠµ (í° ìˆ˜ì˜ ë²•ì¹™) -->
        <div class="card" id="diceSimulationContainer">
            <h2>5. ğŸ² í° ìˆ˜ì˜ ë²•ì¹™ ì²´í—˜ (ì¸í„°ë™í‹°ë¸Œ ì£¼ì‚¬ìœ„)</h2>
            <p>
                ì£¼ì‚¬ìœ„ ë˜ì§€ê¸°ë¥¼ ë°˜ë³µí•˜ë©´ì„œ 'í˜„ì¬ í‰ê· 'ì´ ì´ë¡ ì ì¸ **ê¸°ëŒ“ê°’ 3.5**ì— ìˆ˜ë ´í•˜ëŠ” ê³¼ì •ì„ ëˆˆìœ¼ë¡œ í™•ì¸í•´ ë³´ì„¸ìš”!
            </p>
            
            <button class="btn" id="rollDiceBtn">ì£¼ì‚¬ìœ„ ë˜ì§€ê¸°! ğŸ²</button>
            
            <!-- ì£¼ì‚¬ìœ„ êµ´ë¦¼ ëª¨ì…˜ ì˜¤ë²„ë ˆì´ -->
            <div id="diceOverlay">...</div>

            <div class="formula-display">
                í˜„ì¬ í‰ê·  E(X) ê³„ì‚°ì‹: <span id="meanFormula">E(X) = &Sigma; (ê°’ x í™•ë¥ ) = (1 x P(1) + 2 x P(2) + ... + 6 x P(6))</span>
            </div>

            <div class="result-stats">
                <div class="stat-item">
                    <div class="stat-label">ì´ ì‹œë„ íšŸìˆ˜ (N)</div>
                    <div class="stat-value" id="trialCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">í˜„ì¬ í‰ê·  E(X) = m</div>
                    <div class="stat-value" id="currentMean">--</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">í˜„ì¬ í‘œì¤€í¸ì°¨ Ïƒ(X)</div>
                    <div class="stat-value" id="currentStdDev">--</div>
                </div>
            </div>

            <canvas id="diceCanvas" width="900" height="350"></canvas>
            <div style="text-align: center; margin-top: 10px; font-size: 0.9rem; color: #555;">
                <span style="color: red; font-weight: bold;">[ë¹¨ê°„ ì„ ]</span> ì´ë¡ ì  ê¸°ëŒ“ê°’ (3.5) &nbsp; | &nbsp; 
                <span style="color: blue; font-weight: bold;">[íŒŒë€ ì„ ]</span> í˜„ì¬ í‰ê· 
            </div>
        </div>

        <!-- Section 6: ë¶„ì‚°/í‘œì¤€í¸ì°¨ ê³µì‹ ë° ì—°ìŠµ (êµê³¼ì„œ 'ìŠ¤ìŠ¤ë¡œ í™•ì¸í•˜ê¸°') -->
        <div class="card">
            <h2>6. ğŸ“ ë¶„ì‚° V(X) ê³„ì‚° ì—°ìŠµ (ìŠ¤ìŠ¤ë¡œ í™•ì¸í•˜ê¸°)</h2>
            
            <h3>ë¶„ì‚°ì˜ ê³„ì‚° ê³µì‹</h3>
            <p>
                **ë¶„ì‚° V(X) ê³„ì‚° ê³µì‹**: <span class="math-expr">V(X) = E(X&sup2;) - m&sup2;</span> <br>
                (ë¶„ì‚°ì€ ì œê³±ì˜ ê¸°ëŒ“ê°’ì—ì„œ ê¸°ëŒ“ê°’ì˜ ì œê³±ì„ ëº€ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤.)
            </p>

            <h3>êµê³¼ì„œ ì—°ìŠµ ë¬¸ì œ</h3>
            <p>
                í™•ë¥ ë³€ìˆ˜ Xì˜ í™•ë¥ ë¶„í¬í‘œ: X=1(<span class="math-expr">P=1/4</span>), X=2(<span class="math-expr">P=1/2</span>), X=3(<span class="math-expr">P=1/4</span>)ì¼ ë•Œ,
                ì•„ë˜ ë¹ˆì¹¸ì„ ì±„ì›Œ ë¶„ì‚° V(X)ì™€ í‘œì¤€í¸ì°¨ <span class="math-expr">&sigma;</span>(X)ë¥¼ êµ¬í•´ ë³´ì„¸ìš”.
            </p>

            <div class="practice-input-group" style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">
                <label for="practiceE">E(X) = m =</label>
                <input type="number" id="practiceE" placeholder="ì •ë‹µì„ ì…ë ¥" step="0.1" style="flex: 1;">
            </div>
             <div class="practice-input-group" style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">
                <label for="practiceE2">E(X&sup2;) =</label>
                <input type="number" id="practiceE2" placeholder="ì •ë‹µì„ ì…ë ¥" step="0.5" style="flex: 1;">
            </div>
            <div class="practice-input-group" style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">
                <label for="practiceV">V(X) =</label>
                <input type="number" id="practiceV" placeholder="ì •ë‹µì„ ì…ë ¥" step="0.1" style="flex: 1;">
            </div>
            <button class="btn quiz-btn" id="checkPracticeBtn">ì •ë‹µ í™•ì¸ ë° í’€ì´ ë³´ê¸°</button>
            <div class="quiz-feedback" id="practiceFeedback"></div>
        </div>

        <!-- Section 7: ìµœì¢… í€´ì¦ˆ (ì—¼ì†Œ ì›ìëŸ‰) -->
        <div class="card">
            <h2>7. ğŸ’¯ ìµœì¢… ì ê²€: ì—¼ì†Œ ì›ìëŸ‰ ê¸°ëŒ“ê°’ E(X)</h2>
            <p>
                ìì—°ê³„ ì—¼ì†Œ ì›ìëŠ” ì›ìëŸ‰ 35(<span class="math-expr">P=3/4</span>)ì™€ ì›ìëŸ‰ 37(<span class="math-expr">P=1/4</span>)ë¡œ ì¡´ì¬í•©ë‹ˆë‹¤. ì—¼ì†Œ ì›ìëŸ‰ì˜ **ê¸°ëŒ“ê°’ E(X) = m**ì€ ì–¼ë§ˆì¼ê¹Œìš”?
            </p>

            <label for="quizAnswer" class="stat-label" style="display: block; margin-bottom: 5px;">ì •ë‹µ ì…ë ¥ (ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ê¹Œì§€):</label>
            <input type="number" id="quizAnswer" placeholder="ì˜ˆ: 32.5" step="0.1">

            <button class="btn quiz-btn" id="checkQuizBtn">ì •ë‹µ í™•ì¸</button>
            
            <div class="quiz-feedback" id="quizFeedback"></div>
        </div>
        
    </div>
    
    <!-- 8. Floating Chat Widget (í™”ë©´ ìš°ì¸¡ í•˜ë‹¨ì— ê³ ì •ë˜ëŠ” ì˜ì—­) -->
    <div id="floating-chat-widget" class="closed">
        <div id="chat-header">
            ğŸ¤– AI ë³´ì¡°êµì‚¬
            <button id="close-chat-btn">X</button>
        </div>
        <div id="chatbox">
             <!-- ì´ˆê¸° ë©”ì‹œì§€ -->
            <div class="message ai-message">
                <div class="message-content">
                    ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ì—¬ëŸ¬ë¶„ì˜ ìˆ˜í•™ í•™ìŠµì„ ë•ëŠ” AI ë³´ì¡°êµì‚¬ì…ë‹ˆë‹¤. ê¸°ëŒ“ê°’ì´ë‚˜ ë¶„ì‚°ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆë‹¤ë©´ ì–¸ì œë“ ì§€ ì§ˆë¬¸í•´ ì£¼ì„¸ìš”. ğŸ˜Š
                </div>
            </div>
        </div>
        <div id="chat-input-container">
            <input type="text" id="chatInput" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë¶„ì‚° ê³µì‹ì´ 2ê°œì¸ ì´ìœ ê°€ ë­ì˜ˆìš”?)">
            <button class="btn" id="sendButton">ì§ˆë¬¸í•˜ê¸°</button>
        </div>
    </div>
    
    <!-- ì±—ë´‡ í† ê¸€ ë²„íŠ¼ -->
    <button id="chat-toggle-button">ğŸ’¬</button>

    
    <script>
        // DOM ìš”ì†Œ ì°¸ì¡°
        const conceptCanvas = document.getElementById('conceptCanvas');
        const diceCanvas = document.getElementById('diceCanvas');
        const rollDiceBtn = document.getElementById('rollDiceBtn');
        const checkQuizBtn = document.getElementById('checkQuizBtn');
        const quizAnswerInput = document.getElementById('quizAnswer');
        const quizFeedbackDiv = document.getElementById('quizFeedback');
        const trialCountEl = document.getElementById('trialCount');
        const currentMeanEl = document.getElementById('currentMean');
        const currentStdDevEl = document.getElementById('currentStdDev');
        const checkPracticeBtn = document.getElementById('checkPracticeBtn');
        const practiceFeedbackDiv = document.getElementById('practiceFeedback');
        const meanFormulaEl = document.getElementById('meanFormula');
        const diceOverlay = document.getElementById('diceOverlay');

        // ì‹ ê·œ ì ìš© ë¬¸ì œ DOM ì°¸ì¡°
        const checkDiceSumBtn = document.getElementById('checkDiceSumBtn');
        const diceSumAnswerInput = document.getElementById('diceSumAnswer');
        const diceSumFeedbackDiv = document.getElementById('diceSumFeedback');
        const checkCoinPrizeBtn = document.getElementById('checkCoinPrizeBtn');
        const coinPrizeAnswerInput = document.getElementById('coinPrizeAnswer');
        const coinPrizeFeedbackDiv = document.getElementById('coinPrizeFeedback');


        // AI Chat DOM ì°¸ì¡°
        const floatingChatWidget = document.getElementById('floating-chat-widget');
        const chatToggleBtn = document.getElementById('chat-toggle-button');
        const closeChatBtn = document.getElementById('close-chat-btn');
        const chatbox = document.getElementById('chatbox');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');

        // --- 1. Canvas 1: ì •ì  ê°œë… ì‹œê°í™” ---

        function drawConceptCanvas() {
            const ctx = conceptCanvas.getContext('2d');
            const W = conceptCanvas.width;
            const H = conceptCanvas.height;
            const PADDING = 40;
            const BAR_WIDTH = 20;
            const NUM_POINTS = 10;
            const MU = 0.5; // í‰ê·  ìœ„ì¹˜ (ìƒëŒ€ì )
            const X_START = PADDING;
            const X_END = W - PADDING;
            const X_RANGE = X_END - X_START;

            ctx.clearRect(0, 0, W, H);

            // Xì¶•
            ctx.beginPath();
            ctx.moveTo(X_START, H - PADDING);
            ctx.lineTo(X_END, H - PADDING);
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 3;
            ctx.stroke();

            // í‰ê· (m) í‘œì‹œ
            const muX = X_START + MU * X_RANGE;
            ctx.fillStyle = '#333';
            ctx.fillRect(muX - 2, H - PADDING - 15, 4, 30);
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('m', muX, H - 5);

            // ê°€ìƒ ë¶„í¬ ë°ì´í„°
            const distA = [1, 2, 5, 8, 10, 8, 5, 2, 1, 0.5]; // ë‚®ì€ ì‹œê·¸ë§ˆ (ì´ˆë¡)
            const distB = [2, 3, 3, 4, 5, 5, 4, 3, 3, 2];   // ë†’ì€ ì‹œê·¸ë§ˆ (ë¹¨ê°•)

            const MAX_H = Math.max(10, ...distA, ...distB);
            const HEIGHT_RANGE = H - 2 * PADDING;

            // ë¶„í¬ B (ë†’ì€ Ïƒ) - ë¹¨ê°„ìƒ‰
            ctx.fillStyle = 'rgba(255, 0, 0, 0.4)'; 
            for (let i = 0; i < NUM_POINTS; i++) {
                const x = X_START + (i / (NUM_POINTS - 1)) * X_RANGE;
                const h = (distB[i] / MAX_H) * HEIGHT_RANGE * 0.8;
                ctx.fillRect(x - BAR_WIDTH / 2 - 5, H - PADDING - h, BAR_WIDTH, h);
            }

            // ë¶„í¬ A (ë‚®ì€ Ïƒ) - ì´ˆë¡ìƒ‰
            ctx.fillStyle = 'rgba(0, 128, 0, 0.8)';
            for (let i = 0; i < NUM_POINTS; i++) {
                const x = X_START + (i / (NUM_POINTS - 1)) * X_RANGE;
                const h = (distA[i] / MAX_H) * HEIGHT_RANGE * 0.9;
                ctx.fillRect(x - BAR_WIDTH / 2, H - PADDING - h, BAR_WIDTH, h);
            }
        }

        // --- 2. Canvas 2: ì¸í„°ë™í‹°ë¸Œ ì‹¤ìŠµ (í° ìˆ˜ì˜ ë²•ì¹™) ---

        let diceData = []; 
        let diceCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};
        const THEORETICAL_MEAN = 3.5;

        // í†µê³„ ê³„ì‚° í•¨ìˆ˜
        function calculateStats() {
            const n = diceData.length;
            if (n === 0) return { mean: 0, stdDev: 0 };

            // 1. í‰ê·  (Sample Mean)
            const sumX = diceData.reduce((acc, val) => acc + val, 0);
            const sampleMean = sumX / n;

            // 2. ë¶„ì‚° ë° í‘œì¤€í¸ì°¨
            let sumX2Pi = 0;
            const values = [1, 2, 3, 4, 5, 6];
            
            for (const x of values) {
                const p = diceCounts[x] / n;
                sumX2Pi += x * x * p; // E(X^2) 
            }

            const variance = sumX2Pi - (sampleMean * sampleMean);
            const stdDev = Math.sqrt(Math.max(0, variance)); 

            return { 
                mean: sampleMean, 
                stdDev: stdDev 
            };
        }
        
        // ì£¼ì‚¬ìœ„ í‰ê·  ê³µì‹ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateMeanFormula(n) {
            if (n === 0) {
                meanFormulaEl.innerHTML = `E(X) = &Sigma; (ê°’ x í™•ë¥ ) = (1 x P(1) + 2 x P(2) + ... + 6 x P(6))`;
                return;
            }
            
            let formulaParts = [];
            const values = [1, 2, 3, 4, 5, 6];
            
            for (const x of values) {
                const count = diceCounts[x];
                if (count > 0) {
                    formulaParts.push(`${x} x (${count}/${n})`);
                }
            }
            
            let formulaText = formulaParts.join(' + ');
            
            // í‰ê·  ê³„ì‚° ê³¼ì •ì´ ê¸¸ì–´ì§€ë©´ ì¤„ì„ë§ë¡œ í‘œì‹œ
            if (formulaParts.length > 4) {
                formulaText = formulaParts.slice(0, 2).join(' + ') + ` + <span class="math-expr">...</span> + ${formulaParts[formulaParts.length - 1]}`;
            }

            // ì‹œê·¸ë§ˆ ê¸°í˜¸ëŠ” HTML ì—”í‹°í‹° (&Sigma;) ì‚¬ìš©
            meanFormulaEl.innerHTML = `<span class="math-expr">E(X) &asymp; &Sigma; xi pi</span> = <span class="math-expr">${formulaText}</span>`;
        }


        // í†µê³„ ê²°ê³¼ ì—…ë°ì´íŠ¸ ë° Canvas 2 ê·¸ë¦¬ê¸°
        function updateDiceSimulation() {
            const stats = calculateStats();
            const n = diceData.length;

            trialCountEl.textContent = n;
            currentMeanEl.textContent = stats.mean.toFixed(3);
            currentStdDevEl.textContent = stats.stdDev.toFixed(3);

            drawDiceDistribution(n, stats.mean);
            updateMeanFormula(n);
        }
        
        // ì£¼ì‚¬ìœ„ êµ´ë¦¼ ëª¨ì…˜ í•¨ìˆ˜
        function rollDiceMotion(callback) {
            rollDiceBtn.disabled = true;
            diceOverlay.style.display = 'flex';
            
            const rollText = ['âš€', 'âš', 'âš‚', 'âšƒ', 'âš„', 'âš…'];
            let rollCount = 0;
            let lastRollValue = 0;

            // ì‹¤ì œ ì£¼ì‚¬ìœ„ êµ´ë¦¼ ê°’ ì €ì¥
            lastRollValue = Math.floor(Math.random() * 6) + 1;
            diceData.push(lastRollValue);
            diceCounts[lastRollValue]++;

            const interval = setInterval(() => {
                const randomDie = rollText[Math.floor(Math.random() * rollText.length)];
                diceOverlay.textContent = randomDie;
                rollCount++;

                if (rollCount > 10) { // 10ë²ˆ ê¹œë¹¡ì¸ í›„ ì •ì§€
                    clearInterval(interval);
                    // ì‹¤ì œ ê²°ê³¼ê°’ìœ¼ë¡œ ìµœì¢… ì£¼ì‚¬ìœ„ ëª¨ìŠµ í‘œì‹œ
                    const finalRollIndex = lastRollValue - 1;
                    diceOverlay.textContent = rollText[finalRollIndex]; 
                    
                    // 0.5ì´ˆ í›„ ì‚¬ë¼ì§€ê²Œ
                    setTimeout(() => {
                        diceOverlay.style.display = 'none';
                        rollDiceBtn.disabled = false;
                        callback(); // êµ´ë¦¼ ì™„ë£Œ í›„ ì‹¤ì œ í†µê³„ ì—…ë°ì´íŠ¸
                    }, 500);
                }
            }, 100);
        }

        // ì£¼ì‚¬ìœ„ ë˜ì§€ê¸° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function handleRollDice() {
            rollDiceMotion(() => {
                updateDiceSimulation();
            });
        }

        // Canvas 2 ë¶„í¬ ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function drawDiceDistribution(n, sampleMean) {
            const ctx = diceCanvas.getContext('2d');
            const W = diceCanvas.width;
            const H = diceCanvas.height;
            const PADDING_V = 40;
            const PADDING_H = 30;
            const CHART_H = H - 2 * PADDING_V;
            const CHART_W = W - 2 * PADDING_H;
            const BAR_GAP = 5;
            const BAR_W = (CHART_W / 6) - BAR_GAP;

            ctx.clearRect(0, 0, W, H);

            const maxCount = Math.max(...Object.values(diceCounts));
            const yMax = maxCount > 0 ? maxCount : 1;
            
            // Yì¶• (ìµœëŒ€ ì¹´ìš´íŠ¸)
            ctx.strokeStyle = '#999';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(PADDING_H, PADDING_V);
            ctx.lineTo(PADDING_H, H - PADDING_V);
            ctx.lineTo(W - PADDING_H, H - PADDING_V);
            ctx.stroke();

            ctx.font = '14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillStyle = '#333';
            
            // ë§‰ëŒ€ ê·¸ë˜í”„ ë° Xì¶• ë ˆì´ë¸”
            for (let i = 1; i <= 6; i++) {
                const count = diceCounts[i];
                const barHeight = (count / yMax) * CHART_H;
                const x = PADDING_H + (i - 1) * (BAR_W + BAR_GAP) + BAR_GAP;

                // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
                ctx.fillStyle = 'rgba(0, 123, 255, 0.7)';
                ctx.fillRect(x, H - PADDING_V - barHeight, BAR_W, barHeight);
                
                // ë§‰ëŒ€ ìƒë‹¨ ì¹´ìš´íŠ¸ í‘œì‹œ
                ctx.fillStyle = '#333';
                if (count > 0) {
                     ctx.fillText(count, x + BAR_W / 2, H - PADDING_V - barHeight - 5);
                }

                // Xì¶• ë ˆì´ë¸” 
                ctx.fillText(i, x + BAR_W / 2, H - PADDING_V + 18);
            }
            
            // Yì¶• ë ˆì´ë¸” (ìµœëŒ€ ì¹´ìš´íŠ¸)
            ctx.textAlign = 'right';
            ctx.fillText(yMax, PADDING_H - 5, PADDING_V + 5);

            // --- í° ìˆ˜ì˜ ë²•ì¹™ ì‹œê°í™” ---
            
            // ì´ë¡ ì  ê¸°ëŒ“ê°’ (3.5) - ë¹¨ê°„ ì„ 
            const theoreticalX = PADDING_H + (THEORETICAL_MEAN - 1) * (BAR_W + BAR_GAP) + BAR_GAP + BAR_W / 2;
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(theoreticalX, H - PADDING_V);
            ctx.lineTo(theoreticalX, PADDING_V);
            ctx.stroke();

            // í˜„ì¬ í‰ê·  (sampleMean) - íŒŒë€ ì„ 
            if (n > 0) {
                const sampleX = PADDING_H + (sampleMean - 1) * (BAR_W + BAR_GAP) + BAR_GAP + BAR_W / 2;
                ctx.strokeStyle = 'blue';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(sampleX, H - PADDING_V);
                ctx.lineTo(sampleX, PADDING_V);
                ctx.stroke();
            }
        }

        // --- 3. ì‹ ê·œ ì ìš© ë¬¸ì œ í’€ì´ ë¡œì§ ---
        function checkDiceSum() {
            const userAnswer = parseFloat(diceSumAnswerInput.value);
            const correctAnswer = 7;
            
            diceSumFeedbackDiv.className = 'quiz-feedback';
            diceSumFeedbackDiv.innerHTML = '';

            if (isNaN(userAnswer)) {
                diceSumFeedbackDiv.classList.add('incorrect');
                diceSumFeedbackDiv.innerHTML = "ì •ë‹µì„ ìˆ«ìë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
                return;
            }

            if (Math.abs(userAnswer - correctAnswer) < 0.001) { 
                diceSumFeedbackDiv.classList.add('correct');
                diceSumFeedbackDiv.innerHTML = `
                    <strong>ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!</strong><br>
                    <strong>í’€ì´ ê³¼ì •:</strong>
                    <div class="formula-display" style="text-align: left; margin-top: 10px;">
                        E(X) <span class="math-expr">= 2x(1/36) + 3x(2/36) + ... + 12x(1/36)</span><br>
                        E(X) <span class="math-expr">= (2+6+12+20+30+42+40+36+30+22+12) / 36</span><br>
                        E(X) <span class="math-expr">= 252 / 36 = 7</span>
                    </div>
                `;
            } else {
                diceSumFeedbackDiv.classList.add('incorrect');
                diceSumFeedbackDiv.innerHTML = "ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”. ê° í™•ë¥ ë³€ìˆ˜(ëˆˆì˜ í•©)ì— í•´ë‹¹í•˜ëŠ” í™•ë¥ ì„ ê³±í•´ì„œ ëª¨ë‘ ë”í•´ë³´ì„¸ìš”.";
            }
        }

        function checkCoinPrize() {
            const userAnswer = parseFloat(coinPrizeAnswerInput.value);
            const correctAnswer = 300;

            coinPrizeFeedbackDiv.className = 'quiz-feedback';
            coinPrizeFeedbackDiv.innerHTML = '';

            if (isNaN(userAnswer)) {
                coinPrizeFeedbackDiv.classList.add('incorrect');
                coinPrizeFeedbackDiv.innerHTML = "ì •ë‹µì„ ìˆ«ìë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
                return;
            }

            if (Math.abs(userAnswer - correctAnswer) < 0.001) { 
                coinPrizeFeedbackDiv.classList.add('correct');
                coinPrizeFeedbackDiv.innerHTML = `
                    <strong>ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!</strong><br>
                    <strong>í’€ì´ ê³¼ì •:</strong>
                    <div class="formula-display" style="text-align: left; margin-top: 10px;">
                        E(Y) <span class="math-expr">= 0x(1/8) + 100x(3/8) + 400x(3/8) + 900x(1/8)</span><br>
                        E(Y) <span class="math-expr">= (0+300+1200+900) / 8</span><br>
                        E(Y) <span class="math-expr">= 2400 / 8 = 300</span>ì›
                    </div>
                `;
            } else {
                coinPrizeFeedbackDiv.classList.add('incorrect');
                coinPrizeFeedbackDiv.innerHTML = "ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”. ê° ìƒê¸ˆì— í•´ë‹¹í•˜ëŠ” í™•ë¥ ì„ ê³±í•´ì„œ ëª¨ë‘ ë”í•´ë³´ì„¸ìš”.";
            }
        }


        // --- 4. ì—°ìŠµ ë¬¸ì œ í’€ì´ ë¡œì§ (ìŠ¤ìŠ¤ë¡œ í™•ì¸í•˜ê¸°) ---
        function checkPractice() {
            const E = parseFloat(document.getElementById('practiceE').value);
            const E2 = parseFloat(document.getElementById('practiceE2').value);
            const V = parseFloat(document.getElementById('practiceV').value);
            
            const correctE = 2.0;
            const correctE2 = 4.5;
            const correctV = 0.5;
            const correctSigma = Math.sqrt(0.5);

            let isCorrect = true;
            let feedbackText = "<strong>í’€ì´ ê³¼ì •:</strong><br>";

            if (Math.abs(E - correctE) < 0.001) {
                feedbackText += `<span style="color: green;">âœ” E(X) = 1 x 1/4 + 2 x 1/2 + 3 x 1/4 = ${correctE}</span><br>`;
            } else {
                feedbackText += `<span style="color: red;">âœ˜ E(X) ì •ë‹µ: ${correctE} (ê³„ì‚° ì˜¤ë¥˜)</span><br>`;
                isCorrect = false;
            }

            if (Math.abs(E2 - correctE2) < 0.001) {
                feedbackText += `<span style="color: green;">âœ” E(X&sup2;) = 1&sup2; x 1/4 + 2&sup2; x 1/2 + 3&sup2; x 1/4 = ${correctE2}</span><br>`;
            } else {
                feedbackText += `<span style="color: red;">âœ˜ E(X&sup2;) ì •ë‹µ: ${correctE2} (ê³„ì‚° ì˜¤ë¥˜)</span><br>`;
                isCorrect = false;
            }

            if (Math.abs(V - correctV) < 0.001) {
                feedbackText += `<span style="color: green;">âœ” V(X) = E(X&sup2;) - m&sup2; = 4.5 - 2&sup2; = ${correctV}</span><br>`;
            } else {
                feedbackText += `<span style="color: red;">âœ˜ V(X) ì •ë‹µ: ${correctV} (ê³µì‹ ì ìš© ì˜¤ë¥˜)</span><br>`;
                isCorrect = false;
            }
            
            // í‘œì¤€í¸ì°¨ í‘œì‹œë„ ì¼ë°˜ í…ìŠ¤íŠ¸ì™€ HTML ì—”í‹°í‹° ì¡°í•©ìœ¼ë¡œ ë³€ê²½
            feedbackText += `<br>ë”°ë¼ì„œ í‘œì¤€í¸ì°¨ <span class="math-expr">&sigma;</span>(X) = <span class="math-expr">&radic;0.5</span> &asymp; ${correctSigma.toFixed(4)}`;


            practiceFeedbackDiv.className = 'quiz-feedback';
            if (isCorrect) {
                practiceFeedbackDiv.classList.add('correct');
                practiceFeedbackDiv.innerHTML = "<strong>ëª¨ë“  ê³„ì‚°ì´ ì •í™•í•©ë‹ˆë‹¤!</strong> " + feedbackText;
            } else {
                practiceFeedbackDiv.classList.add('incorrect');
                practiceFeedbackDiv.innerHTML = "<strong>ì¼ë¶€ ê³„ì‚°ì´ í‹€ë ¸ìŠµë‹ˆë‹¤.</strong> í’€ì´ ê³¼ì •ì„ í™•ì¸í•˜ì„¸ìš”.<br>" + feedbackText;
            }
        }


        // --- 5. ìµœì¢… í€´ì¦ˆ ë¡œì§ (ì—¼ì†Œ ì›ìëŸ‰) ---
        function checkQuizAnswer() {
            const userAnswer = parseFloat(quizAnswerInput.value);
            const correctAnswer = 35.5;
            
            quizFeedbackDiv.className = 'quiz-feedback';
            quizFeedbackDiv.innerHTML = '';

            if (isNaN(userAnswer)) {
                quizFeedbackDiv.classList.add('incorrect');
                quizFeedbackDiv.innerHTML = "ì •ë‹µì„ ìˆ«ìë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
                return;
            }

            if (Math.abs(userAnswer - correctAnswer) < 0.001) { 
                quizFeedbackDiv.classList.add('correct');
                quizFeedbackDiv.innerHTML = `
                    <strong>ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!</strong><br>
                    í’€ì´: E(X) = m = (35 x 3/4) + (37 x 1/4) = (105/4) + (37/4) = 35.5
                `;
            } else {
                quizFeedbackDiv.classList.add('incorrect');
                // ì‹œê·¸ë§ˆ ê¸°í˜¸ëŠ” HTML ì—”í‹°í‹° (&Sigma;)ë¡œ ë³€ê²½
                quizFeedbackDiv.innerHTML = "ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”. ê° ì›ìëŸ‰ì— í™•ë¥ ì„ ê³±í•˜ëŠ” ê¸°ëŒ“ê°’ ê³µì‹ (<span class='math-expr'>E(X) = &Sigma; xi pi</span>)ì„ ë– ì˜¬ë¦¬ì„¸ìš”!";
            }
        }

        // --- 6. AI ë³´ì¡°êµì‚¬ (Gemini API) ë¡œì§ ---
        const apiKey = "AIzaSyAl2vvp8QTFE_EULTu0qM0UZyeo9R_yDdU"; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        
        // **ê°•ë ¥í•˜ê²Œ ê°•í™”ëœ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸: ëª¨ë“  LaTeX/MathJax/ë³µì¡ ê¸°í˜¸ ì ˆëŒ€ ê¸ˆì§€**
        const systemPrompt = `
            You are a friendly, patient, and knowledgeable AI teaching assistant specializing in high school probability and statistics. Always answer the user's questions clearly, using Korean.
            
            **CRUCIAL RULE: ABSOLUTELY DO NOT USE ANY LATEX OR MATHJAX SYNTAX OR DELIMITERS, INCLUDING $, \\( \\), \\begin{equation}..., or commands like \\frac, \\cdot, \\text, \\times, \\Sigma.** Instead, you MUST use only standard Korean text, simple symbols (like the letter 'x' for multiplication, '/' or '(ë¶„ì/ë¶„ëª¨)' for fractions, '+' for addition, 'ì œê³±' for powers), or HTML entities (like '&times;' for multiplication, '&Sigma;' for summation, '&radic;' for square root).
            
            Your output MUST be plain, conversational Korean text. For mathematical explanations, use clear, step-by-step Korean language and simple examples related to discrete probability variables (like dice, lotteries, or scores). Keep responses conversational and encouraging.
        `;
        let chatHistory = [];
        let isGenerating = false;
        let lastUserMessageId = 0; // for managing history in case of error

        // ì§€ìˆ˜ ë°±ì˜¤í”„ë¥¼ ì´ìš©í•œ fetch í•¨ìˆ˜
        async function fetchWithBackoff(url, options, maxRetries = 5) {
            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) {
                        return response;
                    }
                    if (response.status === 429 && attempt < maxRetries - 1) { // Rate Limit
                        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    throw new Error(`API response failed with status ${response.status}`);
                } catch (error) {
                    if (attempt === maxRetries - 1) {
                        throw error;
                    }
                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        // ë©”ì‹œì§€ë¥¼ UIì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
        function addMessage(role, text) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', role === 'user' ? 'user-message' : 'ai-message');
            
            const contentElement = document.createElement('div');
            contentElement.classList.add('message-content');
            
            // í…ìŠ¤íŠ¸ë¥¼ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ íŒŒì‹±í•˜ì—¬ HTMLë¡œ ë³€í™˜
            contentElement.innerHTML = parseMarkdown(text); 
            
            messageElement.appendChild(contentElement);
            chatbox.appendChild(messageElement);
            chatbox.scrollTop = chatbox.scrollHeight; // ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ ì´ë™
            
            return messageElement;
        }

        // ë¡œë”© ë©”ì‹œì§€ ì¶”ê°€/ì œê±°
        function addLoadingMessage() {
            const loadingMessage = addMessage('ai', '');
            loadingMessage.id = 'loadingMessage';
            loadingMessage.querySelector('.message-content').innerHTML = `
                <div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div>
            `;
        }

        function removeLoadingMessage() {
            const loadingEl = document.getElementById('loadingMessage');
            if (loadingEl) {
                loadingEl.remove();
            }
        }
        
        // ê°„ë‹¨í•œ ë§ˆí¬ë‹¤ìš´ íŒŒì‹± (ë³¼ë“œì²´, ì¤„ë°”ê¿ˆ)
        function parseMarkdown(text) {
            let html = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // **ë³¼ë“œì²´**
            html = html.replace(/\n/g, '<br>'); // ì¤„ë°”ê¿ˆ
            return html;
        }


        // AIì—ê²Œ ì§ˆë¬¸ì„ ë³´ë‚´ëŠ” í•¨ìˆ˜
        async function sendMessage() {
            if (isGenerating) return;
            const query = chatInput.value.trim();
            if (!query) return;

            // 1. UIì— ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            addMessage('user', query);
            chatInput.value = '';
            
            // 2. API í˜¸ì¶œ ì¤€ë¹„
            lastUserMessageId = chatHistory.length; // Save index before pushing
            chatHistory.push({ role: "user", parts: [{ text: query }] });
            isGenerating = true;
            sendButton.disabled = true;
            addLoadingMessage();

            const payload = {
                contents: chatHistory,
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                }
            };
            
            try {
                const response = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const candidate = result.candidates?.[0];
                let aiResponseText = "ì£„ì†¡í•´ìš”, ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    aiResponseText = candidate.content.parts[0].text;
                    // 3. ì‘ë‹µì„ ì±„íŒ… ê¸°ë¡ì— ì¶”ê°€
                    chatHistory.push({ role: "model", parts: [{ text: aiResponseText }] });
                }

                // 4. UI ì—…ë°ì´íŠ¸
                removeLoadingMessage();
                addMessage('model', aiResponseText);

            } catch (error) {
                console.error("Gemini API Error:", error);
                removeLoadingMessage();
                addMessage('model', "ì£„ì†¡í•©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜ë¡œ ì¸í•´ ë‹µë³€ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
                
                // ì—ëŸ¬ ë°œìƒ ì‹œ íˆìŠ¤í† ë¦¬ì—ì„œ ë§ˆì§€ë§‰ ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ì œê±° (ì¬ì‹œë„ë¥¼ ìœ„í•´)
                if (chatHistory.length > lastUserMessageId) {
                    chatHistory.pop(); 
                }
            } finally {
                isGenerating = false;
                sendButton.disabled = false;
            }
        }
        
        // --- 7. ì´ˆê¸°í™” ë° ë°˜ì‘í˜• ì²˜ë¦¬ ---

        // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì • ë° ê·¸ë¦¬ê¸°
        function initCanvasSize() {
            // ë¶€ëª¨ ìš”ì†Œì˜ ë„ˆë¹„ë¥¼ í™•ì¸í•˜ì—¬ ìº”ë²„ìŠ¤ ë„ˆë¹„ ì„¤ì •
            const parentWidth = conceptCanvas.parentElement.clientWidth;
            
            // Canvas ë†’ì´ ì„¤ì • (ê°€ë¡œ í­ì— ë§ì¶° ë¹„ìœ¨ ìœ ì§€)
            // ìµœì†Œ 250px, ìµœëŒ€ 400pxì„ ë„˜ì§€ ì•Šë„ë¡ ì„¤ì •
            const conceptHeight = Math.min(300, Math.max(250, 0.4 * parentWidth)); 
            const diceHeight = Math.min(400, Math.max(300, 0.5 * parentWidth));

            conceptCanvas.width = parentWidth;
            conceptCanvas.height = conceptHeight;
            diceCanvas.width = parentWidth;
            diceCanvas.height = diceHeight;

            // ì£¼ì‚¬ìœ„ ì˜¤ë²„ë ˆì´ í¬ê¸°ë„ ìº”ë²„ìŠ¤ì™€ ë™ì¼í•˜ê²Œ ì„¤ì •
            diceOverlay.style.height = `${diceHeight}px`;

            drawConceptCanvas();
            drawDiceDistribution(diceData.length, calculateStats().mean);
        }
        
        // ì±— ìœ„ì ¯ í† ê¸€ í•¨ìˆ˜
        function toggleChatWidget() {
            floatingChatWidget.classList.toggle('closed');
            if (!floatingChatWidget.classList.contains('closed')) {
                // ì±„íŒ…ì°½ ì—´ ë•Œ ìŠ¤í¬ë¡¤ ë° í¬ì»¤ìŠ¤
                chatbox.scrollTop = chatbox.scrollHeight;
                chatInput.focus();
                // ì±—ë´‡ ë²„íŠ¼ì„ ë‹«ê¸° ë²„íŠ¼ ëª¨ì–‘ìœ¼ë¡œ ë³€ê²½ (X)
                chatToggleBtn.innerHTML = 'X';
            } else {
                 // ì±—ë´‡ ë²„íŠ¼ì„ ë‹¤ì‹œ ì±„íŒ… ì•„ì´ì½˜ìœ¼ë¡œ ë³€ê²½
                chatToggleBtn.innerHTML = 'ğŸ’¬';
            }
        }

        // ì´ˆê¸°í™” í•¨ìˆ˜
        function init() {
            initCanvasSize(); 
            updateDiceSimulation(); 
            floatingChatWidget.classList.add('closed'); // ì´ˆê¸°ì—ëŠ” ë‹«íŒ ìƒíƒœë¡œ ì‹œì‘
        }


        // --- 8. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ë° ì´ˆê¸° ì‹¤í–‰ ---

        document.addEventListener('DOMContentLoaded', function() {
            init();

            // ì´ë²¤íŠ¸ ì—°ê²°
            rollDiceBtn.addEventListener('click', handleRollDice);
            checkQuizBtn.addEventListener('click', checkQuizAnswer);
            checkPracticeBtn.addEventListener('click', checkPractice);
            
            // ì‹ ê·œ ì ìš© ë¬¸ì œ ì´ë²¤íŠ¸ ì—°ê²°
            checkDiceSumBtn.addEventListener('click', checkDiceSum);
            checkCoinPrizeBtn.addEventListener('click', checkCoinPrize);
            
            // AI ì±—ë´‡ ì´ë²¤íŠ¸ ì—°ê²°
            chatToggleBtn.addEventListener('click', toggleChatWidget);
            closeChatBtn.addEventListener('click', toggleChatWidget);
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // ë°˜ì‘í˜• ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬ (iPad/ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ í¬ê¸° ë³€ê²½ ì‹œ ëŒ€ì‘)
            window.addEventListener('resize', initCanvasSize);
            // ì•„ì´íŒ¨ë“œ í™”ë©´ ë°©í–¥ ì „í™˜(orientationchange)ì—ë„ ëŒ€ì‘
            window.addEventListener('orientationchange', initCanvasSize); 
        });
        
    </script>
</body>
</html>

